import React, { useState, useEffect } from 'react';
import { ChevronRight, ChevronLeft, BarChart2, Cloud, AlertTriangle, CheckCircle, Zap, ShieldAlert, Heart, MousePointer, Info } from 'lucide-react';

const SlideDeck = () => {
  const [currentSlide, setCurrentSlide] = useState(0);

  const nextSlide = () => setCurrentSlide(prev => (prev < slides.length - 1 ? prev + 1 : prev));
  const prevSlide = () => setCurrentSlide(prev => (prev > 0 ? prev - 1 : prev));

  // Обработка клавиш стрелок
  useEffect(() => {
    const handleKeyDown = (e) => {
      if (e.key === 'ArrowRight') nextSlide();
      if (e.key === 'ArrowLeft') prevSlide();
    };
    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, []);

  // Данные для облака слов
  const wordCloudData = [
    // LARGE - Ядро (100-80)
    { text: "Экспертный подбор", weight: 100, type: "driver", size: "text-5xl md:text-6xl font-black" },
    { text: "Липкость / Жирность", weight: 95, type: "barrier", size: "text-5xl md:text-6xl font-black" },
    { text: "Муки выбора", weight: 90, type: "pain", size: "text-4xl md:text-5xl font-extrabold" },
    { text: "Эффект «Пустышки»", weight: 85, type: "barrier", size: "text-4xl md:text-5xl font-extrabold" },
    { text: "Гарантия результата", weight: 80, type: "driver", size: "text-4xl md:text-5xl font-bold" },
    
    // MEDIUM - Подтверждение (75-42)
    { text: "Забитые поры / Прыщи", weight: 75, type: "pain", size: "text-3xl font-bold" },
    { text: "Пептиды / Муцин", weight: 72, type: "insight", size: "text-3xl font-bold" },
    { text: "Аллергия / Жжение", weight: 70, type: "pain", size: "text-2xl font-bold" },
    { text: "Ошибки в описании", weight: 65, type: "pain", size: "text-2xl font-semibold" },
    { text: "Готовая схема ухода", weight: 62, type: "driver", size: "text-2xl font-semibold" },
    { text: "Брак дозатора", weight: 60, type: "pain", size: "text-xl font-semibold" },
    { text: "Страх подделки", weight: 58, type: "barrier", size: "text-xl font-semibold" },
    { text: "Отмена подписки", weight: 55, type: "pain", size: "text-xl font-medium" },
    { text: "Пробники / Тест", weight: 52, type: "driver", size: "text-xl font-medium" },
    { text: "Неприятный запах", weight: 48, type: "barrier", size: "text-lg font-medium" },
    { text: "Сбои на кассе", weight: 45, type: "pain", size: "text-lg font-medium" },
    
    // SMALL - Кластеризованный шум (Small clusters)
    { text: "Контентная неясность", weight: 40, type: "noise", size: "text-base opacity-70" },
    { text: "Непрозрачная подписка", weight: 38, type: "noise", size: "text-base opacity-70" },
    { text: "Перегруженность выбора", weight: 36, type: "noise", size: "text-base opacity-70" },
    { text: "Микро-UX трение", weight: 35, type: "noise", size: "text-sm opacity-60" },
    { text: "Неравномерный сервис", weight: 32, type: "noise", size: "text-sm opacity-60" },
    { text: "Тревожность после покупки", weight: 30, type: "noise", size: "text-sm opacity-60" }
  ];

  // Функция для стилей облака
  const getCloudStyle = (type) => {
    switch (type) {
      case 'driver': return 'text-emerald-600 bg-emerald-50 border-emerald-200';
      case 'pain': return 'text-rose-600 bg-rose-50 border-rose-200';
      case 'barrier': return 'text-orange-500 bg-orange-50 border-orange-200';
      case 'insight': return 'text-violet-600 bg-violet-50 border-violet-200';
      case 'noise': return 'text-slate-500 bg-slate-100 border-slate-200';
      default: return 'text-gray-500';
    }
  };

  const slides = [
    // SLIDE 1: Title
    <div className="flex flex-col items-center justify-center h-full text-center space-y-8 bg-gradient-to-br from-slate-50 to-indigo-50 p-12 rounded-xl border border-slate-200">
      <div className="bg-indigo-600 text-white px-4 py-1 rounded-full text-sm font-bold tracking-wide uppercase">Стратегический отчет</div>
      <h1 className="text-5xl md:text-6xl font-black text-slate-900 leading-tight">
        Чего хотят клиенты: <br/>
        <span className="text-indigo-600">Анализ 200+ отзывов</span> <br/>
        и точки роста конверсии
      </h1>
      <p className="text-xl text-slate-600 max-w-2xl">
        От «Полки товаров» к «Гарантии результата». Как закрыть страхи клиента, убрать "сенсорный барьер" и поднять продажи.
      </p>
      <div className="flex gap-4 mt-8">
        <div className="flex items-center gap-2 text-slate-500 text-sm">
          <Info size={16} /> Источники: Отзывы, Форумы, 2GIS, Карты
        </div>
      </div>
    </div>,

    // SLIDE 2: Executive Summary
    <div className="h-full flex flex-col p-8 bg-white">
      <h2 className="text-3xl font-bold text-slate-800 mb-6 flex items-center gap-3">
        <Zap className="text-indigo-600" /> Executive Summary: Главные находки
      </h2>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 h-full">
        
        {/* Боль */}
        <div className="bg-rose-50 p-6 rounded-xl border border-rose-100 shadow-sm relative overflow-hidden">
          <div className="absolute top-0 right-0 p-4 opacity-10"><AlertTriangle size={80} className="text-rose-500"/></div>
          <h3 className="text-rose-700 font-bold text-lg uppercase tracking-wider mb-2">Главная Боль</h3>
          <div className="text-2xl font-bold text-slate-900 mb-2">«Минное поле» выбора</div>
          <p className="text-slate-700">Клиент тонет в ассортименте. Без консультанта (как в офлайне) покупка превращается в стресс. <strong>Analysis Paralysis</strong> ведет к уходу без покупки.</p>
        </div>

        {/* Барьер */}
        <div className="bg-orange-50 p-6 rounded-xl border border-orange-100 shadow-sm relative overflow-hidden">
          <div className="absolute top-0 right-0 p-4 opacity-10"><ShieldAlert size={80} className="text-orange-500"/></div>
          <h3 className="text-orange-700 font-bold text-lg uppercase tracking-wider mb-2">Главный Барьер</h3>
          <div className="text-2xl font-bold text-slate-900 mb-2">«Сенсорная рулетка»</div>
          <p className="text-slate-700">Текстуру нельзя потрогать онлайн. Страх «липкой пленки» и жирности блокирует желание пробовать новое. Это убивает LTV.</p>
        </div>

        {/* Драйвер */}
        <div className="bg-emerald-50 p-6 rounded-xl border border-emerald-100 shadow-sm relative overflow-hidden">
          <div className="absolute top-0 right-0 p-4 opacity-10"><CheckCircle size={80} className="text-emerald-500"/></div>
          <h3 className="text-emerald-700 font-bold text-lg uppercase tracking-wider mb-2">Главный Драйвер</h3>
          <div className="text-2xl font-bold text-slate-900 mb-2">Покупка Экспертизы</div>
          <p className="text-slate-700">Клиент ищет не банку, а <strong>Готовую Схему</strong> («Ирина подобрала»). Готов купить 3-5 средств сразу, если ему дадут протокол «Утро/Вечер».</p>
        </div>

        {/* Инсайт */}
        <div className="bg-violet-50 p-6 rounded-xl border border-violet-100 shadow-sm relative overflow-hidden">
          <div className="absolute top-0 right-0 p-4 opacity-10"><Zap size={80} className="text-violet-500"/></div>
          <h3 className="text-violet-700 font-bold text-lg uppercase tracking-wider mb-2">Главный Инсайт</h3>
          <div className="text-2xl font-bold text-slate-900 mb-2">От магии к «Скинтеллекту»</div>
          <p className="text-slate-700">Доверие сместилось с «чудесного омоложения» на <strong>конкретные ингредиенты</strong> (пептиды, ретинол). Клиент хочет понимать, как это работает.</p>
        </div>
      </div>
    </div>,

    // SLIDE 3: Word Cloud
    <div className="h-full flex flex-col p-8 bg-white relative">
      <h2 className="text-3xl font-bold text-slate-800 mb-2 flex items-center gap-3">
        <Cloud className="text-indigo-600" /> Strategic Meaning Cloud
      </h2>
      <p className="text-slate-500 mb-6">Визуализация того, что реально волнует клиента. Чем крупнее слово, тем сильнее влияние на деньги.</p>
      
      <div className="flex-1 flex flex-wrap content-center justify-center gap-4 overflow-y-auto">
        {wordCloudData.map((item, index) => (
          <div 
            key={index}
            className={`px-4 py-2 rounded-lg border text-center transition-all hover:scale-105 cursor-default ${item.size} ${getCloudStyle(item.type)}`}
          >
            {item.text}
          </div>
        ))}
      </div>
      
      <div className="mt-6 flex justify-center gap-6 text-sm font-medium">
        <div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-emerald-500"></div>Драйвер роста (Деньги)</div>
        <div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-rose-500"></div>Боль клиента</div>
        <div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-orange-500"></div>Барьер к покупке</div>
        <div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-slate-400"></div>Фоновый шум (Риски)</div>
      </div>
    </div>,

    // SLIDE 4: Secondary Factors
    <div className="h-full flex flex-col p-8 bg-white">
      <h2 className="text-3xl font-bold text-slate-800 mb-8">Детализация: Что еще важно?</h2>
      <div className="grid grid-cols-3 gap-6">
        <div className="bg-slate-50 p-5 rounded-lg border border-slate-200">
          <div className="flex items-center gap-2 mb-4 text-rose-600 font-bold">
            <AlertTriangle size={20} /> ТОП-3 Проблемы
          </div>
          <ul className="space-y-3 text-slate-700">
            <li className="font-semibold text-lg">1. Сложность выбора</li>
            <li>2. «Пустышка» (нет эффекта)</li>
            <li>3. Аллергия / Реакция</li>
          </ul>
        </div>

        <div className="bg-slate-50 p-5 rounded-lg border border-slate-200">
          <div className="flex items-center gap-2 mb-4 text-orange-600 font-bold">
            <ShieldAlert size={20} /> ТОП-3 Барьера
          </div>
          <ul className="space-y-3 text-slate-700">
            <li className="font-semibold text-lg">1. Сенсорика (Липкость)</li>
            <li>2. Страх побочек (Прыщи)</li>
            <li>3. Недоверие (Подделки)</li>
          </ul>
        </div>

        <div className="bg-slate-50 p-5 rounded-lg border border-slate-200">
          <div className="flex items-center gap-2 mb-4 text-emerald-600 font-bold">
            <Heart size={20} /> ТОП-3 Желания
          </div>
          <ul className="space-y-3 text-slate-700">
            <li className="font-semibold text-lg">1. Экспертный подбор</li>
            <li>2. Гарантия результата</li>
            <li>3. Безопасность (не навреди)</li>
          </ul>
        </div>
      </div>
      <div className="mt-8 bg-indigo-50 p-6 rounded-lg border border-indigo-100">
         <h4 className="font-bold text-indigo-900 mb-2">Ключевой сдвиг:</h4>
         <p className="text-indigo-800">
           Лояльность покупают не скидки, а <strong>консультанты</strong>, которые берут на себя ответственность за выбор. Клиент хочет переложить ответственность на эксперта.
         </p>
      </div>
    </div>,

    // SLIDE 5: Sentiment Analysis & Micro-Frictions
    <div className="h-full flex flex-col p-8 bg-white">
      <h2 className="text-3xl font-bold text-slate-800 mb-6 flex items-center gap-3">
        <BarChart2 className="text-indigo-600" /> Тональность и Скрытые угрозы
      </h2>
      
      <div className="flex gap-8 items-start h-full">
        {/* Chart Side */}
        <div className="w-1/3 bg-slate-50 p-6 rounded-xl border border-slate-200 text-center">
            <h3 className="text-lg font-bold text-slate-700 mb-6">Общее настроение</h3>
            
            <div className="space-y-4">
              <div className="relative pt-1">
                <div className="flex mb-2 items-center justify-between">
                  <div className="text-emerald-600 font-bold">82% Позитив</div>
                </div>
                <div className="overflow-hidden h-4 mb-4 text-xs flex rounded bg-emerald-100">
                  <div style={{ width: "82%" }} className="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-emerald-500"></div>
                </div>
              </div>

              <div className="relative pt-1">
                <div className="flex mb-2 items-center justify-between">
                  <div className="text-rose-600 font-bold">13% Негатив</div>
                </div>
                <div className="overflow-hidden h-4 mb-4 text-xs flex rounded bg-rose-100">
                  <div style={{ width: "13%" }} className="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-rose-500"></div>
                </div>
              </div>
               <div className="relative pt-1">
                <div className="flex mb-2 items-center justify-between">
                  <div className="text-gray-500 font-bold">5% Нейтрально</div>
                </div>
                <div className="overflow-hidden h-4 mb-4 text-xs flex rounded bg-gray-200">
                  <div style={{ width: "5%" }} className="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-gray-400"></div>
                </div>
              </div>
            </div>
            <p className="mt-6 text-sm text-slate-500 text-left">
              * Высокий позитив благодаря консультантам, но негатив крайне токсичен и влияет на отказ от повторной покупки.
            </p>
        </div>

        {/* Text Side - The Split */}
        <div className="w-2/3 space-y-6">
            <div className="bg-red-50 p-5 rounded-lg border border-red-100">
                <h4 className="font-bold text-red-800 text-lg mb-2">1. Продуктовый барьер (Сенсорика)</h4>
                <p className="text-slate-700 mb-2">Клиент не прощает дискомфорт. Если крем липкий — он летит в мусорку. В онлайне это невозможно проверить.</p>
                <div className="text-sm font-semibold text-red-600">Риск: Отказ от новинок из-за страха ошибиться.</div>
            </div>

            <div className="bg-orange-50 p-5 rounded-lg border border-orange-100">
                <h4 className="font-bold text-orange-800 text-lg mb-2">2. «Тихие убийцы» конверсии (Микро-боли)</h4>
                <p className="text-slate-700 mb-2">Организационная небрежность убивает доверие к экспертности.</p>
                <ul className="list-disc list-inside text-sm text-slate-700 space-y-1 ml-2">
                    <li><strong>Сайт:</strong> Ошибки в описании = «Меня хотят обмануть».</li>
                    <li><strong>Упаковка:</strong> Сломанный дозатор = «Дешевка».</li>
                    <li><strong>Подписка:</strong> Непонятная отмена = «Ловушка».</li>
                </ul>
            </div>
        </div>
      </div>
    </div>,
    
    // SLIDE 6: Action Plan
    <div className="h-full flex flex-col p-8 bg-white">
      <h2 className="text-3xl font-bold text-slate-800 mb-6 flex items-center gap-3">
        <MousePointer className="text-indigo-600" /> План действий: Лечим боли
      </h2>
      
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6 h-full pb-4">
        {/* Step 1 */}
        <div className="flex flex-col h-full bg-slate-50 rounded-xl p-6 border border-slate-200">
            <div className="bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold mb-4">1</div>
            <h3 className="font-bold text-lg mb-4">Контент & Визуал</h3>
            <p className="text-sm text-slate-600 mb-4 flex-grow">
                Нужно продать ощущения через экран и снять «Сенсорный страх».
            </p>
            <ul className="space-y-2 text-sm font-medium text-slate-800">
                <li className="flex items-center gap-2"><CheckCircle size={14} className="text-emerald-500"/> Видео-свотчи текстур</li>
                <li className="flex items-center gap-2"><CheckCircle size={14} className="text-emerald-500"/> Маркеры: «Не липкий», «Матовый»</li>
                <li className="flex items-center gap-2"><CheckCircle size={14} className="text-emerald-500"/> Фото «До/После»</li>
            </ul>
        </div>

        {/* Step 2 */}
        <div className="flex flex-col h-full bg-slate-50 rounded-xl p-6 border border-slate-200">
            <div className="bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold mb-4">2</div>
            <h3 className="font-bold text-lg mb-4">Навигация & Выбор</h3>
            <p className="text-sm text-slate-600 mb-4 flex-grow">
                Убрать Analysis Paralysis. Оцифровать опыт консультанта Ирины.
            </p>
            <ul className="space-y-2 text-sm font-medium text-slate-800">
                <li className="flex items-center gap-2"><CheckCircle size={14} className="text-emerald-500"/> Готовые сеты (Утро+Вечер)</li>
                <li className="flex items-center gap-2"><CheckCircle size={14} className="text-emerald-500"/> Квиз «Подбор ухода»</li>
                <li className="flex items-center gap-2"><CheckCircle size={14} className="text-emerald-500"/> Блок «С этим покупают» (Логичный)</li>
            </ul>
        </div>

        {/* Step 3 */}
        <div className="flex flex-col h-full bg-slate-50 rounded-xl p-6 border border-slate-200">
            <div className="bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold mb-4">3</div>
            <h3 className="font-bold text-lg mb-4">Техническая гигиена</h3>
            <p className="text-sm text-slate-600 mb-4 flex-grow">
                Устранить «мелкие» раздражители, убивающие LTV.
            </p>
            <ul className="space-y-2 text-sm font-medium text-slate-800">
                <li className="flex items-center gap-2"><CheckCircle size={14} className="text-emerald-500"/> Аудит описаний (Content Review)</li>
                <li className="flex items-center gap-2"><CheckCircle size={14} className="text-emerald-500"/> Прозрачная кнопка «Отмена подписки»</li>
                <li className="flex items-center gap-2"><CheckCircle size={14} className="text-emerald-500"/> Стандарты работы с браком</li>
            </ul>
        </div>
      </div>
    </div>
  ];

  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-slate-900 p-4 md:p-8 font-sans">
      <div className="w-full max-w-5xl aspect-video bg-white rounded-2xl shadow-2xl overflow-hidden relative">
        
        {/* Slide Content */}
        <div className="h-full w-full">
           {slides[currentSlide]}
        </div>

        {/* Controls */}
        <div className="absolute bottom-6 right-8 flex gap-4">
          <button 
            onClick={prevSlide}
            disabled={currentSlide === 0}
            className="p-3 rounded-full bg-slate-900/10 hover:bg-slate-900/20 disabled:opacity-30 transition-all text-slate-800"
          >
            <ChevronLeft size={24} />
          </button>
          <div className="flex items-center font-mono text-slate-400">
            {currentSlide + 1} / {slides.length}
          </div>
          <button 
            onClick={nextSlide}
            disabled={currentSlide === slides.length - 1}
            className="p-3 rounded-full bg-indigo-600 hover:bg-indigo-700 shadow-lg text-white disabled:opacity-50 transition-all"
          >
            <ChevronRight size={24} />
          </button>
        </div>
      </div>
      
      <p className="text-slate-500 mt-4 text-sm">Используйте стрелки клавиатуры для навигации</p>
    </div>
  );
};

export default SlideDeck;
